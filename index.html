<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Status Perkara Kejaksaan Negeri Kotamobagu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      margin: 0; padding: 0;
      font-family: 'Times New Roman', serif;
      background: url("WhatsApp Image 2025-10-22 at 12.50.31_fc72869a.jpg") no-repeat center center fixed;
      background-size: cover;
      color: white;
    }

    #loginPage {
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      height:100vh; background:rgba(0,0,0,0.6);
    }
    #loginBox {
      background:rgba(0,0,0,0.75); padding:30px; border-radius:10px; text-align:center;
    }

    input, select {
      width:250px; padding:10px; margin:5px; border:none; border-radius:5px;
      font-family:'Times New Roman';
    }
    button {
      padding:10px 20px; margin:10px; border:none; border-radius:5px;
      background:#007bff; color:white; cursor:pointer;
    }

    #mainPage { display:none; background:rgba(0,0,0,0.6); min-height:100vh; }
    table { width:100%; border-collapse:collapse; background:white; margin-top:15px; }
    th, td { border:1px solid black; padding:10px; color:black; }
    th { background:#ffdddd; color:#ff4444; }

  </style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage">
  <div id="loginBox">
    <h2>ðŸ”’ Login Ke Sistem Status Perkara</h2>
    <input id="username" type="text" placeholder="Username"><br>
    <input id="password" type="password" placeholder="Password"><br>
    <button onclick="login()">Masuk</button>
    <p id="loginError" style="color:#ff8080;"></p>
  </div>
</div>

<!-- MAIN PAGE -->
<div id="mainPage">
  <header style="text-align:center; padding:20px;">
    <h1 style="color:#ff4444;">KEJAKSAAN NEGERI KOTAMOBAGU</h1>
    <h3>Informasi Status Perkara</h3>
    <button onclick="logout()" style="background:#ff4444; position:absolute; right:20px; top:20px;">Logout</button>
  </header>

  <main style="max-width:900px; margin:auto; text-align:center;">

    <div>
      <input id="keyword" type="text" placeholder="Cari nama jaksa / nomor berkas / status">
      <button onclick="cari()">Cari</button>
      <button id="btnTambah" style="display:none;" onclick="toggleForm()">âž• Tambah Data</button>
    </div>

    <div id="hasil"></div>

    <!-- FORM TAMBAH -->
    <div id="formTambah" style="display:none; margin-top:20px;">
      <h3 style="color:#ff4444;">Tambah Data Perkara</h3>
      <input id="tNama" type="text" placeholder="Nama Tersangka"><br>
      <input id="tNomor" type="text" placeholder="Nomor Berkas (boleh pakai / . -)"><br>
      <input id="tJaksa" type="text" placeholder="Nama Jaksa"><br>
      <input id="tTanggal" type="date"><br>

      <select id="tStatus">
        <option value="P-18">P-18</option>
        <option value="P-19">P-19</option>
        <option value="P-19 PERLU P-20">P-19 PERLU P-20</option>
        <option value="PENUNTUTAN">PENUNTUTAN</option>
        <option value="SOP FORM-3">SOP FORM-3</option>
        <option value="P-20 PERLU SOP FORM-3">P-20 PERLU SOP FORM-3</option>
        <option value="P-21 PERLU P-21A">P-21 PERLU P-21A</option>
        <option value="BERKAS TAHAP 1">BERKAS TAHAP 1</option>
      </select><br>

      <button onclick="tambahData()">ðŸ’¾ Simpan</button>
    </div>

    <!-- FORM EDIT -->
    <div id="formEdit" style="display:none; margin-top:20px;">
      <h3 style="color:#ff4444;">Edit Data Perkara</h3>
      <input id="eNama" type="text"><br>
      <input id="eNomor" type="text" disabled><br>
      <input id="eJaksa" type="text"><br>
      <input id="eTanggal" type="date"><br>
      <select id="eStatus">
        <option value="P-18">P-18</option>
        <option value="P-19">P-19</option>
        <option value="P-19 PERLU P-20">P-19 PERLU P-20</option>
        <option value="PENUNTUTAN">PENUNTUTAN</option>
        <option value="SOP FORM-3">SOP FORM-3</option>
        <option value="P-20 PERLU SOP FORM-3">P-20 PERLU SOP FORM-3</option>
        <option value="P-21 PERLU P-21A">P-21 PERLU P-21A</option>
        <option value="BERKAS TAHAP 1">BERKAS TAHAP 1</option>
      </select><br>

      <button onclick="simpanEdit()">Simpan</button>
      <button onclick="batalEdit()">Batal</button>
    </div>

    <div id="tabelContainer"></div>

  </main>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
// CONFIG
firebase.initializeApp({
  apiKey: "AIzaSyAQ3GwaExZXpEaNNFMo5bbfiSDAG3MvH2g",
  authDomain: "status-perkara.firebaseapp.com",
  projectId: "status-perkara"
});

const db = firebase.firestore();

let role = null;

// SAFE ID â€” nomor berkas boleh pakai simbol
function safeId(n) {
  return n.replace(/[^a-zA-Z0-9_-]/g, "_");
}

// LOGIN
function login() {
  const u = username.value.trim();
  const p = password.value.trim();

  if (u === "ADMINPIDUM" && p === "PIDUM123") role = "admin";
  else if (u === "PENGUNJUNG" && p === "TAMPIL123") role = "user";
  else { loginError.textContent = "âŒ Username/Password salah"; return; }

  loginPage.style.display = "none";
  mainPage.style.display = "block";

  if (role === "admin") {
    btnTambah.style.display = "inline-block";
  }

  tampilkanSemua();
}

function logout() { location.reload(); }

// CARI (FULL FIX)
function cari() {
  const key = keyword.value.trim().toUpperCase();
  hasil.innerHTML = "";

  db.collection("perkara").get().then(snap => {
    const data = snap.docs.map(d => d.data());

    const ditemukan = data.filter(p => {
      let nama   = (p.nama   || "").toUpperCase();
      let nomor  = (p.nomor  || "").toUpperCase();
      let jaksa  = (p.jaksa  || "").toUpperCase();
      let status = (p.status || "").toUpperCase();

      return (
        nama.includes(key) ||
        nomor.includes(key) ||
        jaksa.includes(key) ||
        status.includes(key)
      );
    });

    if (ditemukan.length === 0) {
      hasil.innerHTML = `<p style="color:#ff4444;">Tidak ada data ditemukan.</p>`;
      return;
    }

    hasil.innerHTML =
      "<h3 style='color:#ff4444;'>Hasil Pencarian</h3>" +
      ditemukan.map(p => `
        <p><b>Nama:</b> ${p.nama}</p>
        <p><b>Nomor Berkas:</b> ${p.nomor}</p>
        <p><b>Jaksa:</b> ${p.jaksa}</p>
        <p><b>Tanggal:</b> ${p.tanggal}</p>
        <p><b>Status:</b> ${p.status}</p>
        <hr>
      `).join("");
  });
}

// TAMPILKAN SEMUA
function tampilkanSemua() {
  db.collection("perkara").get().then(snap => {
    const data = snap.docs.map(d => d.data());

    tabelContainer.innerHTML = `
      <h3 style="color:#ff4444;">Semua Data Perkara</h3>
      <table>
        <tr>
          <th>Nama</th>
          <th>Nomor Berkas</th>
          <th>Jaksa</th>
          <th>Tanggal</th>
          <th>Status</th>
          ${role === "admin" ? "<th>Aksi</th>" : ""}
        </tr>

        ${data.map(p => `
          <tr>
            <td>${p.nama}</td>
            <td>${p.nomor}</td>
            <td>${p.jaksa}</td>
            <td>${p.tanggal}</td>
            <td>${p.status}</td>
            ${role === "admin" ? `
              <td>
                <button onclick="editData('${p.nomor}')">Edit</button>
                <button onclick="hapusData('${p.nomor}')">Hapus</button>
              </td>` : ""}
          </tr>
        `).join("")}
      </table>
    `;
  });
}

// TAMBAH
function tambahData() {
  const p = {
    nama: tNama.value.trim(),
    nomor: tNomor.value.trim(),
    jaksa: tJaksa.value.trim(),
    tanggal: tTanggal.value,
    status: tStatus.value
  };

  const id = safeId(p.nomor);

  db.collection("perkara").doc(id).set(p).then(() => {
    alert("Data ditambahkan!");
    tampilkanSemua();
    formTambah.style.display = "none";
  });
}

// EDIT
function editData(nomor) {
  const id = safeId(nomor);

  db.collection("perkara").doc(id).get().then(doc => {
    const p = doc.data();

    formEdit.style.display = "block";
    eNama.value = p.nama;
    eNomor.value = p.nomor;
    eJaksa.value = p.jaksa;
    eTanggal.value = p.tanggal;
    eStatus.value = p.status;
  });
}

// SIMPAN EDIT
function simpanEdit() {
  const nomor = eNomor.value;
  const id = safeId(nomor);

  const p = {
    nama: eNama.value,
    nomor: nomor,
    jaksa: eJaksa.value,
    tanggal: eTanggal.value,
    status: eStatus.value
  };

  db.collection("perkara").doc(id).set(p).then(() => {
    alert("Perubahan disimpan!");
    formEdit.style.display = "none";
    tampilkanSemua();
  });
}

// HAPUS
function hapusData(nomor) {
  if (!confirm("Hapus data ini?")) return;

  const id = safeId(nomor);

  db.collection("perkara").doc(id).delete().then(() => {
    alert("Data dihapus!");
    tampilkanSemua();
  });
}

function toggleForm() {
  formTambah.style.display =
    formTambah.style.display === "none" ? "block" : "none";
}

function batalEdit() {
  formEdit.style.display = "none";
}
</script>

</body>
</html>
